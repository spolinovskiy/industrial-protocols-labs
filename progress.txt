# Progress Log

- 2026-01-09: Created PRD.json with initial task backlog and initialized progress.txt to track Ralph methodology execution.
- 2026-01-09: Stabilized CIP WebAPI gateway. Gateway now computes DI/AI/timer/counter values locally, reads only DO/AO from cpppo server, and issues reset writes when DO_05 pulses. Updated CIP gateway service in compose, added CIP view seed script polling=1000ms, removed pycomm3 from CIP server. Verified on l-machine: `proto-gateway-cip` /tags returns 26 items within 5s.
- 2026-01-09: Increased CIP WebAPI polling interval to 3000ms to avoid FUXA overload warnings; restarted FUXA after updating CIP device seed.
- 2026-01-09: Updated diagnostics CIP capture to include WebAPI gateway traffic on tcp/9000 and refreshed menu label for clarity.

- 2026-01-09: Added MQTT direct-connection lab updates. Device bridge now mirrors AO/AI, counts switch/threshold events, handles reset pulse (DO_05), and uses env-configured broker. Added FUXA DB patch script for MQTT device/view and updated MQTT seed type to MQTTclient.

- 2026-01-09: Fixed MQTT connectivity by removing host port binding for proto-server-mqtt so it stays on mqtt_net and is resolvable by FUXA; rebuilt MQTT bridge so switch/threshold counters publish correctly.

- 2026-01-09: Removed duplicate CIP Test Bench view using scripts/fuxa_dedupe_cip_view.py on l-machine; kept one CIP view in FUXA DB.

- 2026-01-09: Hardened labctl stop logic to tolerate zero proto-server containers without failing.

- 2026-01-10: Added DNP3 WebAPI gateway (FastAPI) with internal IO logic and background DNP3 master scans. Added proto-gateway-dnp3 service and FUXA DB patch script to bind DNP3 view to WebAPI.
- 2026-01-10: Made DNP3 gateway build optional for pydnp3 (WITH_PYDNP3 build arg) and kept default build lightweight; verified gateway image builds without pydnp3.
- 2026-01-10: Reverted DNP3 to gateway-only logic (no outstation) by removing pydnp3 master wiring in `protocols/dnp3/gateway/app.py`, keeping internal DO/DI mirroring, AO/AI mirror, timer, counters, and reset. Updated compose so `proto-server-dnp3` only runs under profile `dnp3-full`. Verified gateway tag read/write flow locally via FastAPI imports using a temporary PYTHONPATH.
- 2026-01-10: Added IEC-104 WebAPI gateway (FastAPI) with internal IO mirroring, timer/counter/reset logic, plus Dockerfile/requirements. Added proto-gateway-iec104 service in compose and created scripts/fuxa_add_iec104_view.py to clone Modbus view and bind IEC-104 tags via WebAPI endpoint.
- 2026-01-10: Normalized Test Bench styling in FUXA DB using scripts/fuxa_update_view_styles.py: set led_1..led_4, output_1..output_3, and shape_24 to #1f8ed3ff and renamed AI bar from reset to ai_bar across all Test Bench views.
- 2026-01-11: Added guest-only FUXA instance with Modbus-only project, updated nginx routing for guest vs admin, and created scripts/fuxa_make_guest_db.py + .sh to prune guest DB to the Modbus Test Bench.
- 2026-01-11: Removed advanced shell option from diagnostics menu to prevent ttyd users from accessing a raw shell.
- 2026-01-11: Added HTTPS/TLS guidance in README covering nginx termination and external reverse proxy options plus WebSocket notes.
- 2026-01-11: Authored docs/deployment_evaluation.md with VM sizing, multi-user risks, switchover flow, and backend API integration steps.
- 2026-01-11: Added lab switcher prototype (platform/lab_switcher/index.html + scripts/lab_switcher_server.py) to switch protocols, stop/pause servers, and toggle FUXA device enablement.
- 2026-01-11: Renamed admin account to proto-researcher across nginx auth, diagnostics ttyd login, and README credentials.
- 2026-01-11: Blocked guest navigation routes (/home, /config, /configurator) at the gateway to keep guest access Modbus-only.
- 2026-01-11: Documented lab switcher UI usage and token auth in README.
- 2026-01-11: Measured cold start and switchover timings on l-machine and documented results plus optimization guidance in docs/switchover_performance.md.
- 2026-01-11: Added docs/blog/01-industrial-protocols-overview.md with the updated protocol philosophy article.
- 2026-01-11: Added docs/blog/02-version-control-plant-floor.md covering OT adoption of version control principles.
- 2026-01-11: Authored docs/replit_integration_roadmap.md with integration steps, QA checks, multi-user scenarios, recovery plan, and a Replit agent prompt.
- 2026-01-12: Integrated Replit frontend into repo as frontend/ and updated README with fullstack layout notes.
- 2026-01-12: Added SSE status stream to lab switcher server and UI for live protocol status updates.
- 2026-01-12: Updated docs/replit_integration_roadmap.md with SSE status stream guidance and proxy notes.
- 2026-01-12: Aligned frontend lab switcher integration, added SSE status stream, and added Start Lab action with correct HMI URLs.
- 2026-01-13: Added frontend Dockerfile, lab-switcher container, and web nginx reverse proxy for unified site on port 8080.
- 2026-01-13: Added auth fallback to run frontend without Postgres/Replit env, using in-memory auth storage and disabled login routes.
- 2026-01-13: Fixed lab-switcher volume mount to repo root so the control server can start reliably.
- 2026-01-13: Updated nginx proxy to re-resolve container DNS using Docker resolver and variable proxy_pass to avoid 502 after rebuilds.
- 2026-01-13: Added local auth mode for frontend, relaxed CSRF host matching, and removed guest basic auth in gateway to allow Modbus guest start.
- 2026-01-13: Updated labctl to start only protocol services (no base recreation) to avoid switch conflicts.
- 2026-01-13: Normalized guest/admin FUXA paths by redirecting protocol slugs to /lab and forcing frontend HMI link to /lab.
- 2026-01-13: Added web proxy redirects so /guest/<protocol> and /admin/<protocol> land on the correct /lab endpoints.
